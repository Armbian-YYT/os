#
# This config generates all artefacts except for EOS targets
#
common-gha-configs:
  armbian-gha: &armbian-gha
    runners:
      default: "ubuntu-latest"
      by-name:
        kernel: [ "self-hosted", "Linux", "alfa" ]
        uboot: [ "self-hosted", "Linux", "fast", "X64" ]
        armbian-bsp-cli: [ "fast" ]

targets:

  all-base-files-and-rootfs-cli-minimal:
    configs: [ rpardini-generic ]
    pipeline:
      build-image: no # don't build images for this
      only-artifacts: [ "armbian-base-files", "rootfs" ] # only armbian-base-files and rootfs artifacts
      gha: *armbian-gha
    expand: # expand causes the items matrix to multiply. if you have X items, and 6 expands, you'll get 6X items. In this case, 3 items, 6 expands, total 18 items.
      jammy:
        RELEASE: "jammy"
      lunar:
        RELEASE: "lunar"
      bullseye:
        RELEASE: "bullseye"
      bookworm:
        RELEASE: "bookworm"
      trixie:
        RELEASE: "trixie"
      sid:
        RELEASE: "sid"
    vars: # common vars. both the items and the expansions can override these.
      BUILD_MINIMAL: "yes"
      BUILD_DESKTOP: "no"
    items:
      - { BOARD: uefi-arm64, BRANCH: current } # arm64
      - { BOARD: uefi-x86, BRANCH: current } # amd64
      - { BOARD: tinkerboard, BRANCH: current } # armhf
      # riscv64 needs to be done in a separate target, since only sid supports it

  all-desktop:
    enabled: yes
    configs: [ armbian-images ]
    pipeline:
      gha: *armbian-gha
    vars:
      BUILD_MINIMAL: "no"
      BUILD_DESKTOP: "yes"
      DESKTOP_ENVIRONMENT: "xfce"
      DESKTOP_ENVIRONMENT_CONFIG_NAME: "config_base"
      DESKTOP_APPGROUPS_SELECTED: "none"
      RELEASE: "jammy"
    items-from-inventory:
      #wip: yes # includes all work-in-progress boards
      #all: yes # includes all available BOARD and BRANCH combinations
      #conf: yes # includes all supported boards
      #not-eos: yes # not-eos boards, all branches
      not-eos-with-video: yes # not-eos boards, all branches, with video out

  all-cli:
    enabled: yes
    configs: [ armbian-images ]
    pipeline:
      gha: *armbian-gha
    vars:
      BUILD_MINIMAL: "yes"
      BUILD_DESKTOP: "no"
      RELEASE: "jammy"
    items-from-inventory:
      #wip: yes # includes all work-in-progress boards
      #all: yes # includes all available BOARD and BRANCH combinations
      #conf: yes # includes all supported boards
      not-eos: yes # not-eos boards, all branches
